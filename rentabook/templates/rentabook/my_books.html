{% extends "base_generic.html" %}

{% block main %}
<div class="alert alert-success alert-dismissible fade show" role="alert" style="display: none">
    <span id="remove_book_success" style="display: none">
        Success! <b><span id="remove_book_title"></span></b> has been removed.
    </span>
    <span id="add_book_success" style="display: none">
        Success! <b><span id="add_book_title"></span></b> has been added.
    </span>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
<br>
<h1>My books</h1>

<div class="py-3">
    {% if user.is_authenticated %}
    Username: {{ user.get_username }}
    {% endif %}
</div>

<ul class="nav nav-tabs nav-fill" id="my_books" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="loaned-tab" data-toggle="tab" href="#loaned" role="tab" aria-controls="loaned"
            aria-selected="true">Loaned</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="borrowed-tab" data-toggle="tab" href="#borrowed" role="tab" aria-controls="borrowed"
            aria-selected="false">Borrowed</a>
    </li>
</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="loaned" role="tabpanel" aria-labelledby="loaned-tab">
        <br>
        {% if loaned_books %}
        <ul>
            {% for bookinst in loaned_books %}
            <li class="{% if bookinst.is_overdue %}text-danger{% endif %}">
                <a href="{% url 'book-detail' bookinst.pk %}">{{ bookinst.title}}</a>
                {% if bookinst.status == 'o' %}
                <span class="text-warning">
                    ({{ bookinst.get_status_display }} to
                    <a href="{% url 'dialogs_detail' bookinst.borrower %}" style="color:inherit">
                        <b>{{ bookinst.borrower }}</b></a>
                    - {{ bookinst.due_back }})
                </span>
                {% else %}
                <span class="{% if bookinst.status == 'a' %}text-success{% else %}text-danger{% endif %}">
                    ({{ bookinst.get_status_display }})
                </span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>

        {% else %}
        <p>There are no books loaned.</p>
        {% endif %}
        <div class="my-5 text-center">
            <a href="{% url 'add-book' %}">
                <button class="btn btn-primary">
                    Add new book
                </button>
            </a>
        </div>

    </div>
    <div class="tab-pane fade" id="borrowed" role="tabpanel" aria-labelledby="borrowed-tab">
        <br>
        {% if bookinstance_list %}
        <ul>

            {% for bookinst in bookinstance_list %}
            <li class="{% if bookinst.is_overdue %}text-danger{% endif %}">
                <a href="{% url 'book-detail' bookinst.pk %}">{{bookinst.title}}</a>
                <span class="text-warning">
                    ({{ bookinst.get_status_display }} from
                    <a href="{% url 'dialogs_detail' bookinst.created_by %}" style="color:inherit">
                        <b>{{ bookinst.created_by }}</b></a>
                    - {{ bookinst.due_back }})
                </span>
            </li>
            {% endfor %}
        </ul>

        {% else %}
        <p>There are no books borrowed.</p>
        {% endif %}
    </div>

</div>

<script>
// Display success message after adding or removing books
if (localStorage.getItem('remove')) {
    document.querySelector('.alert').style.display = "block";
    document.querySelector('#remove_book_success').style.display = "block";
    document.querySelector('#remove_book_title').innerHTML = localStorage.getItem('title');

}
else {
    document.querySelector('.alert').style.display = "block";
    document.querySelector('#add_book_success').style.display = "block";
    document.querySelector('#add_book_title').innerHTML = localStorage.getItem('title');
};

// Clear localstorage value
window.onbeforeunload = () => {
    localStorage.clear();
};
</script>
{% endblock %}